# Arcana Cloud - Production Configuration
# This file is loaded by Spring Cloud Config Server for production profile

# Deployment Configuration
deployment:
  mode: layered

communication:
  protocol: grpc

# Database (use secrets manager in production)
spring:
  datasource:
    url: jdbc:mysql://mysql-primary:3306/arcana_cloud?useSSL=true
    hikari:
      maximum-pool-size: 50
      minimum-idle: 10
      connection-timeout: 10000
      validation-timeout: 5000
      leak-detection-threshold: 30000

# JPA
  jpa:
    show-sql: false
    properties:
      hibernate:
        jdbc:
          batch_size: 50
        order_inserts: true
        order_updates: true

# Redis Cluster
  data:
    redis:
      cluster:
        nodes:
          - redis-node-1:6379
          - redis-node-2:6379
          - redis-node-3:6379
      timeout: 5000ms

# Cache TTL (longer for production)
  cache:
    redis:
      default-ttl-minutes: 30
      users-ttl-minutes: 15
      tokens-ttl-minutes: 120

# JWT (load from secrets manager)
jwt:
  expiration: 1800000  # 30 minutes
  refresh:
    expiration: 604800000  # 7 days

# gRPC with TLS
grpc:
  client:
    tls:
      enabled: true
    keepalive:
      time: 30
      timeout: 10
    deadline-ms: 30000
    max-inbound-message-size: 16777216

service:
  grpc:
    url: arcana-service:9091

repository:
  grpc:
    url: arcana-repository:9092

# Circuit Breaker (stricter for production)
circuit-breaker:
  failure-rate-threshold: 40
  slow-call-rate-threshold: 70
  slow-call-duration-threshold-ms: 3000
  wait-duration-in-open-state-ms: 60000
  permitted-calls-in-half-open-state: 3
  sliding-window-size: 20
  minimum-number-of-calls: 10

# Plugin Security (strict in production)
arcana:
  plugin:
    security:
      enabled: true
      require-signed-plugins: true
      audit-enabled: true
      trusted-certificates-path: /etc/arcana/plugin-certs

# Logging (less verbose in production)
logging:
  level:
    root: WARN
    com.arcana.cloud: INFO
    org.springframework.security: WARN

# Actuator (restrict in production)
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
  endpoint:
    health:
      show-details: when-authorized
